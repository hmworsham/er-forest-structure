---
title: |
  Abiotic influences on subalpine conifer forest structure
author:
  - H. Marshall Worsham, Energy and Resources Group, U. C. Berkeley
  - Haruko M. Wainwright, Department of Nuclear Science and Engineering, Massachusetts Institute of Technology
  - Thomas L. Powell, Department of Earth and Environmental Sciences, The University of the South
  - Nicola Falco, Lawrence Berkeley National Laboratory
  - Lara M. Kueppers, Energy and Resources Group, U.C. Berkeley, Lawrence Berkeley National Laboratory
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  officedown::rdocx_document:
    reference_docx: styles.docx
    tables:
      style: PaperTable
      layout: autofit
      width: 1.0
      table_caption: TRUE
    pandoc_args: ["-Fpandoc-crossref"]
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    latex_engine: pdflatex
  html_document:
    df_print: paged
indent: true
fontfamily: mathpazo
fontsize: 12pt
geometry: margin = 1in
header-includes:
- \usepackage{setspace}\doublespacing
- \usepackage[left]{lineno}
- \usepackage{indentfirst}
- \setlength\parindent{24pt}
- \linenumbers
- \usepackage{dcolumn}
- \usepackage{caption}
- \usepackage{float}
- \usepackage{afterpage}
- \usepackage{siunitx}
- \usepackage{amsmath}
keywords: forest structure, subalpine forest, conifer, ecology, LiDAR, remote sensing, state factor
bibliography: ./ER_Forest_Structure_Paper_Bib.bib # File created from reference manager
csl: ./remote-sensing-of-environment.csl # This can be changed to your citation style of choice
abstract: Abiotic constraints explain much of the variability in forest structure and composition. At broad scales, climatic factors such as actual evapotranspiration (AET) and climatic water deficit (CWD) often emerge as the strongest constraints. However, at finer scales, such as that of a watershed or basin, other locally varying topographic and edaphic factors may mediate the effects of synoptic climate. Here we quantified the effects of abiotic constraints on a complement of conifer stand structural and compositional characteristics on a spatially continuous basis at the scale of a watershed. We used full-waveform LiDAR to derive multiple measures of stand structure across their full ranges within an upper montane--subalpine domain in the Rocky Mountains of Colorado. We also used a species-level classification map to estimate spatial variability in tree species density. Using generalized additive and gradient boosting modeling strategies, we evaluated the covariability of structural and compositional metrics with a suite of climate, topography, soil, and geologic variables, incorporating end members of the abiotic gradients along which forest stands grow. Peak snow input, snow disappearance rate, and soil water storage explained the majority of variability in stand density, with nonlinear structures. Stand density was related to snow water equivalent along an approximately quadratic function, positively to snow disappearance rate and elevation along an approximately cubic function, and positively related to soil water content along a more complex polynomial function. The same factors explained most of the variation in maximum canopy height, quadratic mean diameter, and basal area, but the functional forms were inverse of those for density. Height skew, an index of the relative proportion of small and large trees in a stand, was poorly correlated with all factors. Quantifying the drivers of fine-scale heterogeneity in the structure of montane and subalpine forests is an essential foundation for understanding how these systems will respond to synoptic environmental change, for establishing a baseline against which these responses can be measured, and for devising conservation and management strategies that promote forest resilience.

---
```{r setup, include=F}
config <- config::get(file=file.path('config', 'config.yml'))
devtools::load_all()
load.pkgs(config$pkgs)
```

```{r, echo=F, include=F}
#source('./inst/notebooks/LiDAR/05.10_model_selection.R')
source('./inst/ms/tables.R')
#source('./inst/notebooks/regressions/00.00_plot_rasters.R')
```

# 1. Introduction

Subalpine forests are important contributors to the hydrological cycle, but they are increasingly exposed to stresses associated with climate change. Shifts in the structure and composition of these forests are underway and are expected to have outsize effects on the timing and quantity of water released into the major water basins of the Western U.S. (Milly and Dunne 2011; Foster et al. 2020). While understanding the environmental factors that shape forest structure has been a foundational concern in ecology and conservation (Waring and Running 1998, Turner and Gardner 2015), most studies have evaluated their relationships at continental to global scales and have therefore overlooked important aspects of local variability (e.g. @stephenson_climatic_1990). Understanding the fine-scale drivers of structural and compositional variability is essential for forecasting how mountain forests will respond to novel environmental pressures, and for devising conservation and management strategies that promote forest resilience. 

Forest structure and composition emerge from complex interactions between a variable abiotic environment and the trait-driven mechanisms by which biotic agents influence or respond to this environment @prentice_concepts_1986; @prentice_pattern_1990; @mcdowell_pervasive_2020. A large corpus of work has described these interactions (e.g. @shreve_vegetation_1915 and @whittaker_consideration_1953; @delcourt_dynamic_1983; @stephenson_climatic_1990; @urban_forest_2000; Swensen 2007; Moles et al. 2009; Zhang et al. 2016; @fricker_more_2019). At broad (i.e. continental or global) scales, climate is often the dominant feature in these interactions and is therefore thought to be the primary driver of species distributions and structural diversity (@whittaker_consideration_1953; @urban_landscape_1987; @stephenson_climatic_1990). Gradient analyses have often identified temperature and moisture (usually indexed with precipitation) as the strongest climatic constraints (see @stephenson_climatic_1990's review). However, several limitations hamper interpretation of these effects. First, temperature and precipitation tend to covary closely along elevational and latitudinal gradients and so cannot be easily disentangled (@urban_forest_2000). Second, this same interdependence may obscure underlying vegetation-environment dynamics: e.g. temperature partially drives atmospheric demand and influences stomatal regulation, contributing both positive and negative feedbacks to plant-available moisture (Peters et al. 2018). And third, the asynchrony of precipitation input and atmospheric demand in many domains can lead to seasonal bias in estimates of plant-available water and energy over time (@stephenson_climatic_1990; @stephenson_actual_1998; @urban_landscape_1987). Adding to the muddle, recent work has challenged the primacy of climate altogether: at least one study has found that edaphic properties, namely parent material in the upper 10 cm soil layer, explain a greater share of variation in the abundance of trees across global biomes than climate factors (@delgado-baquerizo_influence_2020), though this may be partially explained by connections between soil composition and moisture capacity.

As difficult as it has proven at broad scales to isolate specific abiotic drivers of emergent forest properties and to quantify their relative influence, the task is perhaps even more difficult at finer scales, such as those of the watershed or hillslope, where other locally varying factors modulate or mask synoptic climate signals. For instance, topographic properties such as elevation and aspect substantially influence local radiation and soil moisture and thereby modulate regional climate forcings (@dobrowski_climatic_2011; Adams et al. 2014; Barnard et al. 2017). Even in low-diversity forests, physiognomy can vary dramatically with small changes in position. This variability is often especially pronounced in mountainous domains because of the potential for large changes in topographic position over small horizontal distances (@dobrowski_climatic_2011). In temperate mountain forests, structural characteristics such as stem diameter, basal area, and maximum tree height are generally thought to decline with increasing elevation, with temperature as the key limiting control (Whittaker 1956; Day and Monk 1988). The same properties also decline from valley to ridge positions--perhaps as a result of decreasing soil moisture along the convergence gradient--and from northeast-to-southwest exposures in the Northern Hemisphere--perhaps due to increasing vapor pressure deficit along the aspect gradient (@mcnab_terrain_1989; @mcnab_topographic_1993; @bolstad_forests_2018). Topography also appears to influence species mix (Rowe and Sheard 1981; Barnes et al. 1982; Bailey 1988), and species affinities for certain topographic positions may be attributable to functional strategies developed in response to variability in radiative (Monin et al. 2007; White and Millet 2008) and hydrologic (Whittaker 1956, Day and Monk 1988; Hawthorne and Miniaat 2018) regimes. 

While these general trends are often assumed, the actual environment-vegetation complex that appears on a landscape can be considerably more difficult to predict. A site's radiation regime, for instance, may be further modified by shading from adjacent landforms, while its precipitation regime may be modified by local orographic lift or rain shadowing. Steep slopes can increase the risk of biomechanical damage (King et al. 2009), while wind exposure may mechanically limit tree height (Larjavaara 2010) and produce heterogeneous patterns of snow redistribution and ablation (Hiemstra et al. 2002). Further, soil properties (parent material, texture, depth, e.g.) directly constrain plant-available water and nutrients. Any of these factors, or their system of interactions, poses constraints to which trees must respond.

It is worth noting that the preponderance of data supporting the assumed trends comes from Eastern North American deciduous forests and the tropics, and very little from forests of Western ranges, where one might expect even more pronounced topoclimatic variability. The few studies that have evaluated a complement of abiotic controls on forest structure and composition in Western mountain domains challenge some of these assumptions. @fricker_more_2019 found that climatic water deficit (CWD) and mean annual precipitation (MAP) explained the majority of variance in the distribution of maximum tree heights along an elevational gradient in the Sierra Nevada. They also reported that, although taller trees occurred (as expected) in convergent, low-radiation positions, the elevational control on height was strongly non-linear, with bimodal maxima near the lower and upper elevational limits of the domain. This may suggest an "ameliorative" effect of radiation exposure on the elevational lapse rate. @greenberg_limitations_2009 found a unimodal distribution of stem densities in a Sierra Nevada basin, with the highest densities occurring around 1900 m a.s.l., but with a clear divergence in density between high radiation, low moisture (i.e. water-limited) and low radiation, high moisture (i.e., energy-limited) positions. @lydersen_topographic_2012 found the tallest and largest-diameter trees on upper slopes and at elevations above 1690 m in mixed conifer forests across the Sierra Nevada. @kane_water_2015 found that topography explained little variance in forest structure in a Sierra Nevada domain with a frequent fire return interval. 

These observed deviations may indicate that fundamentally different constraints act on forest structure in the West, where actual evapotranspiration (AET) is much lower than in Eastern forests, and where AET increases and moisture deficit decreases with increasing elevation. It is thought that these dynamics work together to impose water limitations on lower-elevation forests and energy limitations on high-elevation forests (Kane et al. 2015), but these limits likely arise from a more dynamic system than elevation alone would suggest. Slope and aspect, for instance, modify solar irradiance and, by extension, temperature and photosynthetically active radiation (PAR). Western montane forests with high slope and aspect heterogeneity may therefore be limited by water in some positions, and by temperature or energetics in others, independent of elevation. 

One major challenge in confronting these uncertainties has been the difficulty of acquiring representative measurements of forest structure and their environmental covariates. Almost all prior work in this area has relied on plot or transect observations, which likely do not represent the full ranges of either structural/compositional or abiotic gradients, particularly in complex, inaccessible terrain (@hurtt_beyond_2004; @antonarakis_using_2011, @lydersen_topographic_2012, @antonarakis_imaging_2014). Even within mature, close-canopied forests, characteristics such as stand density, age-class distribution, allometry, species composition, and species dominance can have wide variance. Efforts to scale up these properties to a watershed from plot observations (or plot-benchmarked models) alone can yield substantial error terms.

Light Detection and Ranging (LiDAR) may help to overcome some of these limitations by enabling comprehensive measurements of forest structure on a spatially continuous basis (@mallet_full-waveform_2009). In particular, full-waveform LiDAR datasets from aerial and satellite platforms, along with new open-source libraries for cleaning and processing the data, have the potential to provide spatially rich information about forest stand characteristics (@mallet_full-waveform_2009; @zhou_waveformlidar_2019; @zhou_gold_2017). Like discrete-return points, waveforms can be used to delineate individual canopy trees and to estimate individual-scale characteristics such as stem diameter, stem height, stem volume, and crown volume (@jucker_allometric_2017; @zhou_waveformlidar_2019; @dalponte_system_2011). Waveforms can also be processed to generate continuous estimates of forest structure parameters at the grid scale. Using waveforms appears to yield higher accuracy than discrete returns in both object-oriented and continuous-estimate methods, particularly for characterizing mid-canopy and sub-canopy structure (@anderson_is_2016; @adams_another_2011; Chauve et al. 2009). Calibrating remote sensing estimates against *in situ* stem diameter and height measurements yields further accuracy improvements (@antonarakis_using_2011; @jucker_allometric_2017). 

In addition, hyperspectral remote sensing data have increasingly been used to characterize species abundance and compositional patterns in forests (Plourde et al. 2007; @anderson_integrating_2008; Fricker et al. 2019; Falco et al. in review). The advantage of hyperspectral sensing lies in the specificity with which it records spectral responses, which can be leveraged to generate accurate target classifications. Integrating information on forest structure and species composition can improve the dimensionality and detail of ecosystem representation from remote sensing (@anderson_integrating_2008; Asner 2012; Marrs 2019).

@kane_water_2015, @bolstad_forests_2018, @greenberg_limitations_2009, and @fricker_more_2019 are the only studies we have identified that use LiDAR to evaluate forest structure or composition along abiotic gradients on a spatially continuous basis in temperate North American forests, and we have found none from the Rocky Mountains. Additionally, to our knowledge, no prior study has (a) exploited the high granularity of waveform LiDAR to estimate multiple structural properties through the canopy profile and integrated these estimates with species compositional metrics, and (b) characterized their associations with climate, topography, soil, and lithology on a spatially continuous basis. To address this gap, we evaluated two questions in low-diversity subalpine conifer forests broadly representative of those occurring across the Southern Rocky Mountains: 

1. How accurately can various aspects of forest stand structure be predicted through the canopy profile, and what is the predicted distribution of forest structure parameters across this landscape?
2. Which climate, topographic, and substrate variables exert the strongest influences on conifer forest stand structure and species mix, and to what extent do these features interact?

We used a full-waveform LiDAR dataset acquired over Colorado’s East River watershed to quantify forest canopy structure through the vertical profile. We integrated these metrics with a species classification map derived from imaging spectrometry and assessed the performance of structural and compositional estimates using field inventory measurements of 4355 trees. We then used inferential modeling strategies to quantify the relative influence of individual  and interacting abiotic factors on the spatial variability of forest stand structure and composition.

<!-- Hypotheses: -->
<!-- 	1. the interaction between elevation and topographic wetness is a stronger explainer of total stem density and basal area than any single topographic variable, and that both density and basal area will vary inversely with the two-way interactions.  -->
<!-- 	2. We expected a clear division between pine and spruce-fir distributions, explained by the interactions between elevation, aspect, and hillslope. In general, we expected pine to dominate lower-elevation and south-facing slopes and spruce-fir to dominate north-facing slopes and higher elevation positions. However, we anticipated that the interaction between elevation and hillslope position would complicate this general trend somewhat, because of cool-air pooling that allows lower minimum temperatures and lower evaporative demand to persist in valley bottoms, even at low elevations where pine would otherwise be expected (Dobrowksi 2011). -->
<!-- 	3. Spruce and fir total stem density diverge, with spruce density increasing with elevation and fir density reaching a peak at mid-elevations.  -->

# 2. Methods
## 2.1. Study area
The study domain comprised upper montane-subalpine conifer forests in Colorado’s East River watershed (38°55’ N, 106°56’ W; Fig. 1). The East River is a headwater tributary of the Colorado River, the principal freshwater source for one in 10 people in the U.S. (U.S. Department of the Interior Bureau of Reclamation 2012). The 750 km^2^ catchment includes six major drainages discharging to perennial streams. Mean annual temperature is 1.9 º C, with a mean monthly maximum and minimum of 11.2 º C and –7.1 º C respectively, measured 1980--2023 at the NOAA Crested Butte weather station (CBUC2) at 2700 m near the center of the watershed. Mean annual precipitation is 1200 mm y^–1^, approximately 70 percent arriving as winter snow and 30 percent as rain during the summer monsoon. Maximum air temperatures are depressed at high elevations and minimum air temperatures by cold air downwelling at low elevations. Precipitation is also strongly influenced by elevation, with snow accumulation generally increasing with higher elevation. 

Besides these broad patterns, the domain’s stark relief and topographic complexity coordinate to produce highly variable local climatic conditions. The watershed has 1420 m of elevational relief, multiple peaks extending above treeline, and pronounced gradients in slope, aspect, insolation, and hillslope position. Within the forested parts of the domain, slopes range from 0.5º to 49º, with a median of 17º. Aspects are approximately evenly distributed around the compass, although there are slightly more southwest-facing slopes than those facing other directions. 

Approximately 34 percent of the forested domain is underlain by the cretaceous Mancos shale formation, 24 percent by Middle-Tertiary granodioritic laccoliths, dykes, and sills, and another 21 percent by coal-bearing sandstone-silt deposits of the cretaceous Mesa Verde Formation. The remainder comprises a mixture of minor sandstone and mudstone formations as well as younger glacial and colluvial landslide deposits. Soils derived from these diverse parent materials show substantial variability in plant-available water, with estimated soil available water capacity (AWC) ranging from 0.02 to 0.19 cm H_2_O cm^-1^ soil.

The dominant tree species are *Picea engelmannii*, *Abies lasiocarpa*, *Pinus contorta*, and *Populus tremuloides*, with occasional *Pseudotsuga menziesii* and *Pinus flexilis* at mid-elevations and one known population of *Pinus longaeva* near treeline on one peak. Natural histories of subalpine forests elsewhere in Colorado describe species distribution patterns that largely hold in this domain. *P. engelmannii* and *A. lasiocarpa* tend to co-occur in high densities throughout the subalpine zone (~2700–-3000 m a.s.l.) and only sparsely in the upper montane zone (~1850--2900 m a.s.l.). At middle and high elevations up to treeline, the longer-lived spruce is often the canopy dominant (~70 percent of canopy basal area), while fir may occupy up to the same proportion of the understory (Alexander et al. 1984). Near treeline, pure spruce stands are common, while fir often dominate the canopy in the lower end of the subalpine zone, particularly in xeric topographic positions (Alexander 1987). Douglas fir (*Pseudotsuga menziesii*) tend to dominate mesic sites, including north-facing toe-slopes and high-elevation south-facing slopes. *P. contorta* also occur intermixed with spruce and fir on dry, southerly upper slopes in the lower range of the subalpine zone and abundantly in monospecific, even-aged stands throughout the montane zone, particularly on south-facing slopes and steep slopes of all aspects (Veblen 1986). Near the lower limits of the Engelmann spruce and subalpine fir elevational range, lodgepole pine tends to establish as a pioneer post-disturbance and is later replaced by the former species (Whipple and Dix 1979). 

Management and disturbance influence forest structure and could obscure relationships between forest vital rates, emergent structure/composition, and underlying abiotic constraints. Logging related to the mining industry occurred in some parts of the watershed during the 19th and early 20th centuries, with a limited footprint enduring today. This said, the watershed includes large stands where little to no tree removal occurred, and stands with old trees and uneven age and size structure are well distributed. In addition, all forested areas analyzed sit on Forest Service land, and 22 percent of these in management-restricted wilderness. We suggest that, because of its low timber value, long fire return intervals, and relative lack of recent management, this domain offers a more realistic basis for understanding abiotic drivers of stand structure in a temperate conifer forest than previous efforts.

## 2.2 Full-waveform LiDAR
Between June 12 and 26, 2018, the National Science Foundation National Ecological Observatory Network (NEON) Airborne Observation Platform (AOP; @kampe_neon_2010) surveyed approximately 330 km^2^ of the watershed (@goulden_neon_2020; @chadwick_integrating_2020; Fig. 1). The AOP collected discrete-range and full-waveform LiDAR returns using an Optech Gemini discrete LiDAR sensor and waveform digitizer with a pulse repetition frequency between 33 and 100 kHz. Discrete-return point density in the post-processed dataset ranged between 1 and 9 returns $m^{-2}$, which was insufficient for characterizing subcanopy structure. We therefore elected to process the full waveforms, which had a nominal density between 1 and 4 pulses m^-2^. Exploiting the higher information density of full-waveform pulses allowed us to develop more complete characterizations of stand structure than would have been possible with discrete returns alone.

We followed a standard approach for processing the waveforms into an analyzable structure. First, we used a spectral deconvolution procedure to isolate the target-response signal from its interactions with the LiDAR system's outgoing pulse, atmospheric scattering, and system noise. We used the Gold deconvolution algorithm in the `waveformlidar` package in the R statistical computing environment (@zhou_waveformlidar_2019), but refactored its implementation for parallel computing. The result of the algorithm approximates the true distribution of scattering objects along the outbound light pulse's path. We then applied an adaptive Gaussian decomposition algorithm to fit one or more Gaussian models to the return pulse components based on Equation 1 (Harding 2005): 

$$f(x,\theta) = \sum_{(i=1)}^{n} A_i exp\biggl[-\frac{(x-\mu_i)^\lambda}{(2\sigma_i^2)}\biggr]$$ {#eq:eqn1}

where $A_i$ is the amplitude of waveform component $i$, $\mu$ is the bin location of $i$ (measured as a point in time, ns), $\sigma$ is the standard deviation of $i$, and $\lambda$ is a penalty parameter that minimizes model residual over a specified number of iterations. Fitting was accomplished using the function `nlsLM` in the R package `minpack.lm`. Where multiple peaks were detected, the algorithm fit a separate function to each and expressed the final fit as the sum of $n$ Gaussian functions. 

The deconvolution and decomposition procedures were applied to the full set of waveforms in parallel on 256 cores on the University of California, Berkeley's high-performance computing cluster. In total, we processed approximately 1.4*10^9^ waveform returns. Of these, a negligible fraction (approximately 0.5 percent) either had no detectable peaks or represented backscatter records that could not be fit to a Gaussian function. Where peaks could not be identified, the waveforms were dropped from the set. Where they could not be fit to the Gaussian, the characteristic components (e.g, amplitude, time to median energy) were estimated from the deconvolved returns directly, without curve fitting.

After decomposition, we used the geolocation matrices provided with the NEON data to geolocate the waveforms and then extracted characteristic metrics from the fitted waveforms. These included the peaks’ location in three-dimensional space, their amplitude and width, front slope, and time to median intensity (NEON 2015). We then used the R package `rlas` to discretize this information (Jean-Romain 2022). We normalized the discretized points to the Earth surface by differencing their z-values against a digital elevation model (DEM) derived from the discretized point cloud. We then decimated the high-density returns, preserving all of the identified peaks to obtain a discretized point cloud of 5.72*10^9^ points with a uniform density of 15.3 points m^-2^ across the domain.

## 2.3 Field census

Between 2018 and 2022, we established 25 long-term forest monitoring plots in the East River and nearby drainages. The sites were stratified across six topographic gradients (Table 1). An initial set of 68 sites was preselected via Latin hypercube sampling on six topographic gradients derived from the USGS 1/3-arc second DEM (@usgs_dem_2017). The final 25 sites were selected from among that group after scouting and optimizing the distribution of the set along the topographic gradients (Fig. S1). At each site we installed a 40 m x 40 m plot, using slope corrections to approximate a projected flat-surface area of 1600 m^2^. To minimize edge effects, we located plots at least 100 m from forest edges and major compositional transitions. We aimed to partially mitigate unobserved management and disturbance effects by siting inventory plots in stands where no recent harvest or major disturbance had occurred, based on (a) visual inspection for cut stumps and remnants and (b) stability of the Normalized Difference Vegetation Index (NDVI) over the 40-year Landsat record (1980-present).

We used a survey-grade GNSS receiver (Trimble Geo 7X, Trimble, Inc.) to georeference all plot locations *in situ*. To establish absolute georeferencing we made a minimum of six measurements over multiple days at each plot corner and took the arithmetic mean of recorded coordinates, inversely weighted by reported horizontal uncertainty. Positioning data were post-processed in TerraSync (Trimble Inc.) with differential correction using the Continuously Operating Reference Stations (CORS) Network station SE01 (39.40035, -107.212101; NOAA 2020). Estimated planimetric accuracy of plot corner locations was $\pm$ 0.35 m.

We conducted a field census of approximately 9000 trees in the 25 plots (Table 2). All trees of any species with a diameter at breast height (DBH, measured at 1.3 m above the ground) $\geq$ 1.0 cm were labeled with an aluminum tag. For each tagged tree, we recorded species and measured diameter at breast height (DBH) using a standard metric forestry diameter tape (for stems $\gt$ 7 cm DBH) or calipers ($\leq$ 7 cm). We measured stem heights with a Nikon LaserPro II laser hypsometer (for stems $\gt$ 5 m in height) or a rigid metric tape measure ($\leq$ 5 m). To maximize precision, hypsometer measurements were repeated on each tree until measurements converged within 0.5 m. Expected vertical accuracy on hypsometer measurements was $\pm$ 1.0 m. 

Stems were then geolocated using either the GNSS receiver or by measuring the direction and distance from a geolocated reference tree with a digital compass and rigid metric tape. For those positioned with the GNSS, the receiver was positioned in contact with the side of each tree stem at 1.3 m. We enforced a maximum estimated horizontal uncertainty threshold of 1.0 m during recording, and we recorded a minimum of 30 positional observations at a rate of 1 observation s^-1^ for each stem. In total, 5899 (89.4 percent) of the stems surveyed were positioned. Those without unique geolocations were less than 5 m in height and were fully suppressed beneath the canopy of another tree, such that it was extremely unlikely for tree crown segmentation to differentiate the suppressed tree from the dominant. For geotagged trees, mean planimetric accuracy was 1.01 m (s.d = 0.70 m).

Seventeen of the 25 plots lay within the overflight footprint of a 2018 NEON AOP acquisition (@goulden_neon_2020; @goulden_post_2020; @chadwick_integrating_2020). We used the observations from this subset for training and validation of models developed in the next phase of analysis. The 17 focal plots contained 5828 observed trees, of which 4355 were living at the time of inventory. 

## 2.4. Tree crowns, species composition, and stand structure

### 2.4.1 Tree crowns
We followed the general approach in Dalponte and Coomes (2016) to generate an individual tree crown (ITC) map and gridded estimates of conifer forest structure and composition. The tree crown map comprised point objects describing the position, height, and stem diameter of all trees $gt$ 1.3 m height in conifer stands. The gridded data comprised continuous maps of forest structure metrics at 100m grid scale. To generate these products, we integrated the discretized LiDAR and inventory data to optimize and validate an individual tree detection (ITD) model at the field plots, which we then applied in the watershed's remaining forested area. As we detail below, this approach (1) iterated through many permutations of possible parameters for seven ITD algorithms; (2) computed performance metrics at each iteration; and (3) selected the best performing algorithm and parameter set to apply to out-of-sample data. 

First, we extracted the discretized LiDAR data within a 5 m buffer around the boundaries of each field plot. We then attempted to detect tree crown objects from the discretized data using algorithm $A_i$ and parameter set $\lambda_{j,k:l}$, where $\lambda_j$ is one of a set of parameters taking user-specified values required for the algorithm to proceed, and $k:l$ is a vector of values on that parameter (Table S1). The 5 m buffer ensured that points associated with trees along plot boundaries were correctly included in the operation; however, any trees identified in the buffer zone outside of the plots were removed after each detection attempt. We then applied the automated matching procedure described in @eysn_benchmark_2015 and @pang_nystrom-based_2021 to link detection results to reference observations from field inventory. In this way, we were able to evaluate the performance of each algorithm-parameter combination and compare models against each other. We opted for an automated matching approach because (1) the computational scale of our method (up to 2800 delineation attempts per algorithm per site) made manual interpretation infeasible, and (2) doing so enabled us to enforce clear, objective rules for reproducibility. In early testing, we also evaluated bipartite matching strategies seeking to minimize the Euclidean and Mahalanobis distances between detected and reference trees (@hansen_optimal_2006). We ultimately selected the @eysn_benchmark_2015 method based on superior inter-tree and inter-site matching performance. 

The matching process began by selecting the tallest detected tree ("target") and searching for candidates among reference trees satisfying Euclidean height (∆Z) and horizontal distance (∆XY) criteria specified in Table 3. The reference candidate with the least ∆XY was chosen as a tentative match to the target. The candidates were then queried a second time. If a candidate with greater ∆XY proved closer in height to the target, and its ∆XY was at most 2.5 m more than ∆XY of the tentative match, it was selected as the match. However, since an optimal match depends not only on the neighborhood of reference trees, but also on other nearby *detected* trees, the target was then compared against other detected neighbors. If another detected tree was closer in horizontal and vertical distance to the matched reference, the pairing was discarded. This process was repeated on all remaining detected trees in descending order of height, until all reference trees had been evaluated. Matches were then removed from the set, and the process was repeated until no further matches could be found under the search criteria. 

For each run of $\lambda_{i,j:k}$ on $A_i$ we tallied the extracted trees, true positives (TP, or successful matches) false positives (FP, or commission errors), and false negatives (FN, or omission errors). We used these values to compute the performance statistics in Table 4. The root mean squares (RMS) of all performance statistics were calculated across the 17 plots as unbiased estimators of the performance of each $A_i$ and parameter set $\lambda_{i,j:k}$.

We then selected the algorithm and parameter permutation that had yielded the maximum root mean square *F* score across all $\lambda_{i,j:k}$. *F* is a proportion representing the harmonic mean of precision (the proportion of all tree detections that were correctly matched) and recall (the proportion of all possible matches that were correctly matched). Perfect detection and match rates would yield an *F* score of 1.0, while failure would yield 0.0. It was selected as the optimization statistic over overall accuracy for its balanced sensitivity to both over- and under-detection. 

Of the eight algorithms tested, LayerStacking (@ayrey_layer_2017) yielded the highest *F* score across training and testing sets (Table 4, Table S2). The algorithm proceeds by first dividing the point cloud into stacked horizontal layers at 1-m intervals, starting at $\lambda_1$ m above ground (Table 5). A series of clustering procedures is then applied to each layer. In the lowest three layers ($\lambda_{1}+1 : \lambda_{1}+3$ m a.g.), points are clustered through Density-Based Scanning (Ester et al. 1996); points within these initial clusters are removed as non-tree low vegetation, while those lying outside clusters are retained as sparse returns from small tree boles. Next, a canopy height model (CHM) of resolution $\lambda_2$ is computed from the point cloud. Tree tops are identified from the CHM using a local maximum filter (LMF) with a window of radius $\lambda_3$. Then, points in each layer undergo *k*-means clustering, using the local maxima as seeds, and a polygonal buffer of radius $\lambda_4$ is placed around each resulting cluster. The polygons from each layer are then flattened and rasterized to create an intermediate "overlap map." This abstraction quantifies the density of clusters, such that areas of high-density polygonal overlap represent individual trees. In conifer forests, this delineation can be improved with an additional parameter, $\lambda_5$, which enforces higher weighting for clusters near the canopy top, because these tend to be closer to a conifer's center. A second LMF is applied to the overlap map, using a window of radius $\lambda_6$, and local maxima are taken to be tree centers. Additional smoothing of the local maxima, and filtering and merging of clusters, yields a set of points representing tree tops with embedded height and position information.

For the remainder of the LiDAR-surveyed domain, we subset the discretized waveforms over conifer forest by finding their intersection with conifer-classified pixels from a species-level classification map derived from the NEON hyperspectral acquisition (Falco 2023). We forced the LayerStacking algorithm with this subset of LiDAR data and the optimal parameter permutation to delineate all tree crowns in the watershed's conifer stands. The result was a spatially continuous dataset of conifer tree objects describing their locations and heights. To estimate the DBH of each delineated object, we estimated coefficients for an allometric function using binned plot observations, following @jucker_allometric_2017. The equation to fit was $\hat{DBH} = exp[\alpha + \beta\ log(H)] \times exp[\sigma^2/2]$, where the H is tree height and $\sigma^2$ is the mean square error of the regression. Per Jucker 2017, the last term is an approximation of theoretical model error $\epsilon$, assuming $\epsilon$ is normally distributed, and is imposed to yield an unbiased prediction of DBH. 

### 2.4.2. Species composition
The tree-crown product was fused with a forest species classification dataset, developed  at 1 m resolution through a support vector machine classifier on 2018 NEON AOP hyperspectral imagery (Falco 2023). From the discretized waveforms, we computed a canopy height model at 0.5 m resolution across the full domain and used this to force a marker-controlled watershed segmentation algorithm, with the identified tree crown objects as controls (Plowright et al. 2023). This procedure produced polygons demarcating the estimated crown perimeters of every crown identified through LayerStacking. Because the passive imaging spectrometer generally received reflectance signals only from light-exposed portions of tree canopies, it was necessary to filter our segmented tree crown objects to match the hyperspectral targets as nearly as possible. Attempting to align species information with mid- and subcanopy objects yielded unacceptably poor agreement. We therefore filtered the LiDAR-detected trees to the canopy top by removing all objects below the 90th percentile height. We performed the filtering independently in each cell of a 100 m grid to account for height variability across the domain. We then overlaid the remaining polygons on the classification raster and assigned each object to a single tree species according to the majority rule, i.e., if 50 percent or more of the pixels intersecting the object were classified to that species (@dalponte_individual_2019). For objects where less than 50 percent of pixels belonged to a single species, we labeled the object "NA." 

### 2.4.3. Forest structure
From the fused product, we computed continuous area-based structural metrics by summarizing object-level predictions at specified grid scales across the watershed (Fig S2). Structural metrics included total number density (TND),stand basal area (BA), quadratic mean diameter (QMD), diameter and height percentiles, and skewness of height, all computed at the level of a grid cell. TND (stems ha^-1^) was a sum of the number of trees over grid cell area for all trees and per species. BA (m^2^ ha^-1^) was computed as: 

$$BA = \frac{\sum_{i=1}^{n}\pi (DBH/2)^2}{grid\ cell\ area}$$ {#eq:eqn2}

QMD (cm) was computed as:

$$QMD = \sqrt{\frac{1}{n}\sum_{i}^{n}{DBH^2}}$$ {#eq:eqn3}

where $n$ is the number of trees in the cell. Skewness of height was computed as the third central moment of the distribution of stem heights. Larger positive values signified a more positive skew, with a larger proportion of trees in smaller height classes than a normal distribution. More negative skew values signified a negative skew, with a larger proportion of trees in larger height classes. To further restrict the analysis to intact conifer forest stands (as opposed to isolated trees or mixed forest), we further masked each raster, preserving pixels where conifer total number density was greater than 100 stems ha^-1^ and removing a 100 m buffer around roads, developed areas, and the outer perimeter of the NEON AOP LiDAR acquisition. During processing, we discovered that the waveform returns from four adjacent AOP flightpaths were missing. According to the NEON post-flight report, a hardware failure on June 6, 2018 prevented the waveform digitizer from collecting GPS timing signals, which rendered the waveform data irretrievable (@goulden_post_2020). In early testing we attempted to gap-fill this region by processing the NEON discrete-return point cloud, but ultimately abandoned the effort because of unacceptable anomalies from the higher-fidelity waveform-based estimates. This gap is visible as an empty north-south swath in the forest structure products and is excluded from analysis, along with a 100 m buffer around its perimeter to minimize edge effects.

## 2.5. Abiotic explanatory variables

### 2.5.1. Topography 
We generated six topographic variables from the NEON 1 m DEM (see Table 1 and Fig. S3). We prioritized factors whose variability has been shown to modify the radiation or moisture budget in trees' local growing environments (Frey et al., 2016). Elevation (m) was computed at the 100 m pixel scale by averaging the raw DEM. Slope angle (degrees) and aspect (degrees) were computed from the elevation product with the `terrain` method in the R package `terra` with 8 neighbors, using the method in Horn (1981). We further transformed the aspect product by folding values about the 25ºNE--205ºSW line. This transformation--onto a scale with a maximum on southwest faces and minimum on northeast faces--yields a more ecologically relevant measure of aspect-constrained exposure (@mccune_equations_2002). The fold line we selected represented the estimated angles of highest and lowest mean annual incident radiation in the domain, given the watershed's latitude and slope orientation. Total heat load (unitless index) was calculated from folded aspect and slope angle using the method in @mccune_equations_2002. Topographic position index (TPI) is a morphometric measure that classifies a landscape into slope position classes, from toeslope to ridgetop We computed TPI at each pixel as the difference between the elevation at the target point and the mean elevation within a neighborhood of 9 pixels (1000 m), normalized to the standard deviation of elevation in that window (Gallant and Wilson 2000; @de_reu_application_2013). TPI values are more positive when a target point is higher than its neighborhood, and more negative when the target is lower. Topographic Wetness Index (TWI) ($log(m^2/m)$) is a measure of the relative capacity of an area to accumulate water through surface or subsurface flow. We selected this metric as a proxy for relative soil moisture conditions. We used the implementation in the R package `dynatopmodel`, which calculates TWI as the log ratio between a pixel's upslope contributing area and its own slope angle (Quinn et al. 1995, Metcalfe et al. 2018). 

### 2.5.2. Climate
To estimate relative spatial patterns of snow accumulation (m), we retrieved snow water equivalent (SWE) data produced by Airborne Snow Observatories, Inc (formerly NASA/JPL Airborne Snow Observatory; ASO) from flights on March 31, 2018, April 4, 2019, and April 21, 2022 (@deems_lidar_2013; @painter_airborne_2016; @painter_aso_2018; see also https://data.airbornesnowobservatories.com/). The flights occurred before the onset of snowmelt in each season. The ASO SWE product was generated from observations of snow depth, spectral albedo, and radiative forcing from a coupled imaging spectrometer and terrestrial laser scanning system, combined with snow density modeled using iSnobal (@painter_airborne_2016). We also produced an estimate of the relative velocity of snow disappearance (% day^-1^). In each flight year, we differenced the snow-on values and values from subsequent flights in late spring of each-year (May 24, 2018; June 10, 2019; and May 18, 2022, respectively), and normalized these to the snow-on values for a percent change. We then divided these percentages by the day interval between paired flights. While the ASO data may not have captured peak snow depth or maximum snow-free extent in each season, averaging across three years of flights enabled us to approximate dominant spatial patterns of accumulation and disappearance across the basin.

We also used estimates of annual mean total actual evapotranspiration (AET) and climatic water deficit (CWD) generated by the Basin Characterization Model (BCM) for the Upper Colorado Basin from 1985 to 2012 (Buto et al. 2017). The BCM output package characterizes the water balance for a subject region at 270 m resolution. The model is forced with monthly data and has been widely used in ecological and management applications (Flint et al. 2013). From this dataset, AET is the depth of water (mm) evaporated from the surface or transpired by plants within each pixel. CWD is calculated as the difference between potential evapotranspiration (PET) and AET (mm), where PET is the total depth of water that can be evaporated or transpired given prevailing atmospheric conditions. Under non-limited moisture conditions, AET equals PET and CWD is 0; positive CWD values correspond to moisture deficit, or an excess of atmospheric demand relative to available water in the soil (Buto et al. 2017).

### 2.5.3. Soil
To evaluate edaphic effects on forest structure and composition, continuous estimates of soil properties were derived from the U.S. Department of Agriculture (USDA) Natural Resources Conservation Service (NRCS) Soil Survey Geographic Database (SSURGO). (Survey Soil Staff 2022). SSURGO contains geospatial information on soil properties predicted via an ensemble of regression, classification, and machine-learning operations on observations from *in situ* soil samples and environmental predictor variables. Spatial and attribute data were retrieved from the database using the R library `FedData`, using the keys for area symbols that intersect the study domain (CO654, CO660, CO661, CO662). The hierarchical data structure contains polygons demarcating mapping units at 1:12000 scale. Each mapping unit is made up of one to three major components and potentially several minor components. A component is defined as a field-classified soil type with common characteristics. For example, the Evanston component, which appears in our study domain, occurs on side valleys and alluvial fans on slope grades from 5 to 20 percent. Evanston soils are derived from rhyolitic or sandstone alluvium, and organic content tends to be low. While components are not spatially explicit, their proportional contribution to the makeup of a map unit is stated. Further, each component is associated with detailed data from its constituent horizons. 

After joining the spatial and attribute tables, we aggregated horizon-scale data to generate a unique observation per component. For horizons within a given component, we calculated horizon depth--weighted means for available water capacity (AWC, 'awc_r') and hydraulic conductivity (k_sat_, 'k_sat_r') in the top 100 cm of soil. We calculated the horizon depth--weighted mean of percent organic matter (OM, 'om_r') in the top 30 cm of soil. We calculated total soil depth as the maximum horizon depth per component. We took these variables to be independent estimates of soil constraints on tree growth, and the selected soil depths to be those in which the selected variables likely exert the strongest biophysiological effect. These component-scale estimates were aggregated to the map unit scale, weighting mean values by the proportion of each component represented in a map unit. The spatially referenced data were converted from vector to raster format using the `rasterize` function in the R package `terra`.

### 2.5.4. Geology
The underlying geological substrate was characterized by rasterizing the Colorado Geological Survey vector database "R-37: Geology and Mineral Resources of Gunnison County, Colorado" (Morgan 2020). The vector database had been created through digitization of the original sheets used to prepare the U.S. Geological Survey MI-16 Geologic Map of Colorado (Tweto 1979).

## 2.6. Inferential modeling

We quantified relationships between our spatially continuous stand structural metrics and underlying abiotic factors using generalized additive models (GAM) and generalized boosted models (GBM), fitting separate models for each response variable. All data were first (dis-)aggregated to the 100 m pixel scale and aligned to a uniform grid using bilinear interpolation for continuous variables and nearest-neighbor resampling for categorical variables. Because of expected spatially autocorrelative structure in both response and explanatory variables, we also included a tensor product smooth of X and Y pixel coordinates in all models. 

In the GAM approach, we estimated each structural metric as the sum of nonlinear spline functions of the explanatory variables, using the `gam` implementation in the R package `mcgv`. The generalized additive approach allowed us to account for nonlinearities and to uncover variable interactions. We examined the main effects of each explanatory variable, along with two-way interactions between a subset of variables (Table S3). In the GBM approach, we modeled stand structure as a function of abiotic variables using the stochastic gradient boosting framework in R's `caret` and `gbm` libraries (Kuhn 2008; Ridgeway 2007). This decision tree-based strategy yielded estimates of total variance explained in each model, as well as the relative influence of predictor variables. Variable influence is estimated by multiplying the number of times a variable is selected for splitting by the squared increase in deviance explained at each split, and then averaging this value over the ensemble of decision trees. It is expressed relative to the other variables in the model. We chose to use these two strategies in tandem because of their complementary strengths. The GAM strategy allows for interpretation of functional shapes through partial dependence and quantifies effects of interactions between variables. While partial-dependence plots can be estimated from the GBM, their interpretability is usually limited, especially when variable interactions exist, and they are often caveated as rough approximations (@friedman_multiple_2003; @elith_working_2008). On the other hand, the GBM allows for numerical comparison of feature importance, which can be difficult to attain with the GAM. We assumed that convergence between modeling strategies would give us greater confidence in the results, while divergence could provide points of departure for further investigation. 

We initially explored a large set of potential abiotic explanatory variables and interactions and used these to estimate a preliminary run of GAMs for variable screening (Table S4; Fig. S4). We then identified pairs of variables with an absolute-value Pearson's correlation coefficient \gt 0.7 and iteratively dropped highly correlated variables from the models, computing the Akaike Information Criterion (AIC) score at each step. We preserved the feature sets that produced the lowest AIC (Table 1). GAMs were then fitted with response distributions (i.e. 'family' in the `mgcv` specification) corresponding to the structure of the response variable (see Fig.4) and using the restricted maximum likelihood estimator (REML) to select smoothing parameters, because it tends to be less prone to overfitting than generalized cross-validation (GCV) (Wood et al. 2023). Double-penalty regularization was applied for feature selection, wherein an additional shrinkage penalty is constructed for each smooth and removes terms in the null space of the original REML penalty (i.e. flat, fully smoothed terms) (Marra and Wood 2011). GBMs were fitted to each response using the same response distributions and explanatory features as in GAMs (although without specifying interactions). Model parameters were estimated through a full factorial design with 10-fold repeated cross validation. The design matrix varied interaction depth (1 to 5 features), the number of trees (2000 to 10000 trees in increments of 2000), and shrinkage rate (0.1 to 0.01 in increments of 0.02). 

# 3. Results

## 3.1. LiDAR vs. field inventory
Comparing detected trees to the field inventory, the optimal LayerStacking algorithm extracted 4196 trees across the 17 plots (Table 4; see Table S2 for results for each LayerStacking parameter permutation). Of these, 55 percent were successfully matched to field trees (Fig. 2). The root mean square distance between matched trees was 2.45 m in the horizontal dimension and 1.46 m in the vertical dimension. Agreement between matched trees was strong across all size classes. Underdetection and undermatching were most prevalent in trees below 8 m in height, while some overdetection occurred in trees between 15 m and 20 m in height (Fig. 3, panel A).

Of trees detected in training, median height was 8.8 m (s.d. 7.6 m), versus 6.7 m (s.d. 6.9 m) in the field inventory. Maximum canopy height, estimated at the 95th percentile, was more similar, at 24.4 m versus 23.8 m in field inventory. We computed DBH for each detected tree using the fitted equation $\hat{DBH} = exp[-0.1379 + 1.2082\ log(H)] \times exp(0.0105)$, where the third term is $\sigma^2/2$ of the fitted model. QMD of detected trees in the plots was 20.4 cm (s.d. 13.7 cm), versus 18.6 cm (s.d. 12.7) directly measured in the field. We disaggregated median height by site to evaluate performance in more detail (Fig. 3, panel B). Agreement was strongest in high-density, uneven-aged sites (i.e., where median height was smaller), and poorer in sites with low density or a paucity of understory trees (i.e., where median height was larger).

For composition, we compared species classifications for top-of-canopy tree crown objects with their matches identified in the field and generated performance metrics from a confusion matrix. Across species, overall classification accuracy was 0.73 and F1 was 0.42. Per species performance, reported in Table 6, was similar to, but not as strong as that which Falco et al. (2023) reported in generating the original species classification product used here.

## 3.2 Domain-wide structure and composition
Applying the optimal LayerStacking algorithm and parameters to conifer forests across the full domain produced $2.375 \times 10^7$ individual trees, with stand densities ranging from 100 to 2041 stems ha ^-1^. Based on underdetection rates among smaller size classes in training, we assumed that the total number was a modest underestimate. We applied a correction to this value by binning plot-level data into 1-m height increments and computing the difference in frequency of occurrence per bin between field-observed and LiDAR-detected trees. We performed the same binning on detected trees for the full domain and scaled the number of trees per bin in the larger dataset by the plot-level frequency differentials (Fig. 3, panel C). With this correction, we estimated the total number of conifer trees to be $2.392 \times 10^7$.

The spatial distributions of *P. engelmannii* (spruce) and *A. lasiocarpa* (fir) were similar, though maximum absolute densities differed by a factor of two (Fig. 4). Spruce densities ranged from 2 to 336 stems ha^-1^, while fir ranged from 2 to 172 stems ha^-1^ (note that the order of magnitude difference between these values and total density is largely because we only considered top-of-canopy stems when assigning species). *P. contorta* was concentrated almost exclusively on low-elevation slopes near the southern boundary of the domain. The median height of all LiDAR-detected trees in the watershed was 4.8 m (s.d. 6.8 m), and 95th percentile height was 21.7 m (s.d. 15.2 m). Height skewness ranged from -1.8 to 8.8. Allometry-estimated QMD was 17.0 cm (s. d. 8.3 cm). Basal area ranged from 0.03 to 248.8 m^2^ ha^-1^. All of the structure estimates were non-normally distributed (Fig. 5).

## 3.3 Abiotic factors associated with forest structure

The proportion of deviance explained (PDE) in each GAM was similar across the full-forest models (0.61 to 0.64) (Table 7). For models of species-resolved density, PDE was considerably lower, with a nadir at 0.23 for *A. lasiocarpa* (fir). All GAM models were convergent and full rank. Tests for k indicated sufficient basis functions for all parameters, and examination of residual plots indicated low bias in model fits. 

In the GBMs, the cumulative importance of variables in the four broad categories (climate, topography, soil, geology) was similar across responses (Fig. 6, panel A). The five most influential variables on each response cumulatively accounted for 51.8–71.3 percent of relative variable importance (Fig. 6, panel B). The effects of explanatory variables were generally coherent between the two modeling strategies. The top five in each GBM were also significant (p < 0.01) in corresponding GAMs and exerted high leverage on the responses based on interpretation of GAM partial-effects plots (Fig. 7). Those falling below the top five usually had slopes near zero, indicating a null relationship and/or that the smooths had been penalized into the null parameter space and were therefore selected out of the model (partial-dependence plots for all explanatory variables in GAMs appear in Fig. S3). There were occasional exceptions, described in more detail below, in which a variable with apparent leverage in the GAM was not highly influential in GBMs.

All structural metrics were strongly associated with SWE and ∆SWE, which broadly described the snow input component of the watershed's climate, and with elevation (Fig. 7). Other topoclimatic variables related to the water and energetic balance (heat load, AET, CWD, TPI) played a smaller, though still significant, role in all models. One soil factor (CEC) appeared among the top five explanatory variables in one model (pine density). Geologic substrate ranked among the least influential covariates in all models, with a maximum relative influence of 3.3 percent. Any variable ranking below the top five individually had less than 8 percent of the relative influence on any response. Cumulatively, lower-ranked variables accounted for, at most, 49 percent of relative influence. The X-Y coordinate bivariate smooth was a significant factor in the GAMs, indicating the existence of latent spatial structure that was not otherwise measured in explanatory features. 

### 3.3.1 Forest structure and climate
SWE and ∆SWE were the most influential factors in GBMs of total stand density and BA, and they ranked among the top five for all forest structure responses except pine density, for which ∆SWE did not rank highly (Fig. 6). In GAMs, most structural factors had similar nonlinear associations with SWE, with unimodal maxima in responses occurring near 1 s.d. below mean SWE (0.29 m) and long declining tails toward higher SWE (Fig. 7). The lowest density, basal area, maximum height, and QMD were therefore associated with the highest SWE. Height skewness and species-resolved densities proved exceptions to this pattern. Height skew followed an approximately sigmoid growth with SWE, and species densities followed bimodal functions. The most positively skewed stands (i.e., those with a higher proportion of small trees) were associated with high SWE. Species densities decreased with above-average SWE. 

∆SWE, the relative rate of snow disappearance, showed a negative linear relationship with BA, maximum height, and QMD, so that these structural metrics were lowest in sites with the fastest snow disappearance rates. This relationship was unimodal for density, with a maximum near -1 s.d. ∆SWE (~ 0.37 % d^-1^). For height skew, the relationship was positive but became asymptotic, approaching 1.3, at +1 s.d. ∆SWE (0.96 % d^-1^).

The remaining two climate variables, AET and CWD, were only occasionally influential. AET ranked among the five most influential covariates for BA (non-monotonic decline); total density and spruce density (unimodal structure with a maximum near mean AET ~ 4.5 x 10^4 mm y^-1^); and maximum height and QMD (bimodal structure with maxima near $\pm$2 s.d. from mean (3.31 x 10^4^ mm y^-1^ and 5.87 x 10^4^ mm y^-1^). CWD was influential in explaining only fir and pine density. Fir density declined linearly with CWD, while pine density followed an approximately quadratic relationship, with a maximum near 2 s.d. above the mean (~3.4 x 10^4^ mm y^-1^) and a steep decline toward maximum CWD. Although it did not rank highly in the GBMs, CWD appeared to have a quadratic relationship with maximum height and QMD, and a negative linear relationship with height skew and total density. Given that CWD and ∆SWE were somewhat linearly correlated (Pearson's r = 0.56), the CWD signal may have been overshadowed by the larger variance in ∆SWE, although the evident difference in functional forms suggested that CWD exerted its own independent influence.

### 3.3.2 Topography 
Elevation appeared among the top five covariates for every structural metric and was the most influential factor for maximum height and QMD (23.7% and 19.3% of relative influence, respectively). Total density had an approximately negative-linear relationship with elevation. For height skew, the association was approximately quadratic with a unimodal minimum near mean elevation (~3199 m). All other structural metric had non-monotonic relationships with elevation, with maxima near -1 s.d. from mean (~ 2986 m) with declines toward higher elevation values becoming asymptotic around +2 s.d. from mean (~ 3624 m).

Heat load was the single most influential covariate for fir density (12.6 % of relative influence) and was among the most influential for maximum height, QMD, height skewness, total density, and the density of fir and spruce. Functional forms varied. Maximum height and QMD were approximately logistic growth functions on heat load, while height skew, and fir and spruce density were approximately quadratic functions. Total density increased exponentially with heat load. Terrain curvature and TPI were the only other topographic factors to emerge as major explanatory features, for BA and height skew respectively. Curvature had a slight negative linear relationship with BA. TPI exerted modest leverage on height skew, and the shape of the curve suggested that more positively skewed stands (with a larger proportion of small trees) occurred at TPI values around -0.5, coinciding with low- and toeslopes, and more negatively skewed stands (with more large trees) at TPI values around 0.7, coinciding with upper slopes and midslope ridges. While TWI was not a top-ranked feature in GAMs, it did appear to exert a negative linear influence on total density and on the three species-resolved density measures, but the response was of a smaller magnitude than SWE or ∆SWE (Fig. S3).

### 3.3.3 Soil
Soil factors accounted for at most 22% of cumulative influence in any GBM. CEC emerged as an influential feature in the GBM for pine density, although its partial effect in the GAM appeared smaller than that of other highly influential features. AWC also exerted a notable influence on maximum height and QMD, along a bimodal function with minima at 0.06 and 0.15 cm H_2_O cm^-1^ soil, approximately -2 s.d. and 1 s.d. from the mean. 

### 3.3.4 Geology
Although geology was among the least influential variables across all models, there were select instances where geologic substrate had an effect on forest structure and composition (Fig. 8). On landslide deposits (Ql), basal area was 10 m^2^ m^-2^ greater, QMD 5 cm greater, and maximum height 4 m greater than average. Height skew was higher on Ql, tending toward larger-statured trees. Every response except height skew and pine density tended to be lower than average on granodioritic laccoliths (Tmi). Total density was 240 stems ha^-1^ below average on the Pennsylvanian-Permian sandstone and shale of the Gothic Formation (Pm). Spruce density was also lower on the Gothic Formation, while fir density was slightly higher than average on the red sandstone-mudstone-conglomerate complex of the Maroon Formation. The only substrate with a significant influence on pine density was glacial drift, where density was ~ 9 stems ha ^-1^ lower. 

### 3.3.5	Feature interactions
In the GAM strategy, we included two-way interactions between a subset of explanatory features. All interaction terms were significant in the GAMs. In Fig. 9, we show interaction plots for elevation and the top predictor for each structural variable. The interactive effects were most pronounced for BA, maximum height, and density. Highest stand density occurred at the interface of low elevation and rapid snow disappearance, while the lowest densities occurred at high elevations, regardless of melt rate, and where low elevation and slow melt coincided. The trees with highest QMD tended to occur where low elevation coincided with high soil AWC.

# 4. Discussion

By deriving complete, continuous metrics of multiple conifer forest structure and composition characteristics from field-validated LiDAR detection of individual trees, we were able to evaluate their associations with abiotic factors in the equivalent of more than 19,000 ha-scale sample plots. Not only does this sample far exceed what is feasible with ground-based methods alone, it also includes end-members along both structural and abiotic gradients that are usually not represented in field studies. Our structural metrics showed strong but nonlinear relationships with multiple snow, soil, and topographic factors. The results confirmed our expectation that stand development responds to multiple environmental factors, albeit in complex ways. In particular, in this high mountain watershed, elevation, snow, and soil properties had both direct and interactive effects on stand density, maximum canopy height, QMD, and BA.

## 4.1 Continuous estimation of forest structure

In this study, we used a novel, fully-automated approach to optimize individual tree crown detection from discretized full-waveform LiDAR, constraining and validating detection with tree inventory data from mixed-age stands at all levels of the vertical canopy, down to 1.3 m height. Our detection (0.96) and match rates (0.55) between field-observed and model-detected trees compared favorably with results from prior studies using the same automated matching procedure. In their benchmarking analysis of eight crown-detection algorithms, @eysn_benchmark_2015 reported a maximum match rate of 36% and an extraction rate of 55% with 1.6 m ∆Z accuracy and 0.9 m ∆XY accuracy in a mixed-age conifer site, a substantial underdetection bias compared to our results. @pang_nystrom-based_2021 reported a match rate of 70% on an extraction rate of 103% across 10 sites of varying composition, using a novel detection algorithm that they had developed, and which we did not apply in this study. However, their analysis used a minimum height threshold of 4.2 m, where ours was 1.3 m. @ayrey_layer_2017 reported matching rates of 66%--69% and commission error of 22--29% in their original application of the LayerStacking algorithm in dense uneven-aged conifer forest, compared to our 55% match and 51% commission error. Ayrey et al. manually matched trees through visual observation and enforced a minimum DBH threshold of 10 cm. The comparable strength of agreement in our study suggests that it is possible to map height, location, and DBH at the ITC level with sufficient accuracy using the ITD optimization strategy described here. Our results further support Dalponte and Coomes's (2016) conjecture that tree-centric approaches to quantifying forest characteristics are appropriate, and in some cases even advantageous compared to area-based approaches, because they allow for feature estimation at any (reasonable) spatial scale on the same epistemological basis as a field inventory.

On average, the optimal LayerStacking ITD model underestimated the number of trees in plots by 4%, largely because of underdetection in the lower height classes, offset by overdetection in low-density sites. This underdetection presumably yielded a low density bias, which in turn could contribute to a high QMD bias and a low BA bias, pointing to a need for further refinement of the delineation approach and/or a generalizable correction factor. While we subsequently applied an estimated correction factor (§3.2) to the full domain, it was not possible to apply this at the 100 m pixel scale because the gridded estimates were based on individual detected trees. The model overestimated median height by 2.1 m across plots, but overestimated maximum height by only 0.6 m. This is likely the result of underdetection of smaller trees. In older, even aged sites with sparse understory, median height was substantially underestimated, likely because overlapping lower branches of large trees were incorrectly differentiated as smaller individuals (Fig. 3, panel A). Using site-derived allometric coefficients produced a negligible overestimate of QMD (+ 1.8 cm) relative to field data. This was also tied to underdetection of small trees: diameter estimates were biased toward larger trees and QMD was normalized by a smaller number of trees than actually existed in the plots. That we were able to extract and match a large proportion of true subcanopy trees with relatively low commission error underscores the advantage of full waveform over discrete point data @anderson_is_2016. 

One novel contribution of this analysis was our workflow optimizing tree-crown detection from massive waveform LiDAR data (code available at github.com/hmworsham/er-forest-structure and github.com/hmworsham/rwaveform). One of the critical challenges in large-scale tree mapping is justifying the selection of algorithm and optimal parameters for a particular site and vegetation type (@eysn_benchmark_2015). We addressed this challenge by leveraging statistical learning--type workflows, systematically iterating through multiple algorithms and large permuted sets of parameters and selecting these against an objective loss function. This method allowed us to robustly train and validate ITD procedures while ensuring interpretability of model parameters. We note that other ITD algorithms are available, and others among those we tested may have performed better in other domains, but we suggest that our approach offers a model for reproducible tree detection for the discipline. Our method was also likely successful because our stratified field-plot sampling design that resulted in training samples well distributed across multiple environmental and structural gradients. Our method confirms the possibility of predicting individual-scale tree attributes over a large domain while training on only a small proportion its trees (Question 1).

## 4.2 Species composition

Species classification accuracy was highest for spruce and lowest for fir. The largest source of error was the misclassification of fir crowns as spruce. As these species co-occur in high-density, closed-canopy stands, spectral mixing at the interfaces of intersecting crowns likely gave rise to this confusion. Further uncertainty derived from positional error in geolocating tree crowns in the field, detecting crowns from LiDAR, and delineating crown polygons. While positional matching fidelity was high for top-of-canopy trees, any error from misalignment between field-observed and LiDAR-derived objects would have propagated into the species assignment. Similarly, to the extent that a given crown polygon was over- or undersegmented, pixels associated with adjacent trees of another species could have been improperly included in the majority vote. Nevertheless, the spatial pattern of single-species density distributions cohered with expectations: spruce and fir co-occurred throughout the watershed up to treeline; spruce density exceeded fir density in the canopy top; and pine were largely restricted to lower elevation slopes and areas where disturbance is known to have occurred within the last 100 years.

## 4.2 Abiotic constraints on stand structure and composition

At the scale of this analysis--hectare units across a 700 km^2^ watershed--variability in stand structure was most closely associated with topoclimatic factors driving the water and energy balance. However, structural metrics responded differentially to specific topoclimatic factors. Inferential modeling revealed three distinct patterns of relationship. (1) Density, BA, and the skewness of height were most strongly associated with snow input factors (SWE and ∆SWE), followed by topography (elevation, heat load, curvature) and AET. (2) Maximum height and QMD were most strongly associated with elevation, followed by snow input, and then heat load. (3) Species appeared to mediate the density relationships.

The importance of snow variables, SWE and ∆SWE, is consistent with findings that conifers in this region rely on stored winter precipitation and snowmelt pulses as their primary water source (Berkelhammer et al. 2020; Allen et al. 2019). 

However, the snow relationships with density were inverse of those with other structural factors. Density was low and stable across low-to-median values on the SWE distribution, and increased toward the upper extreme. The other factors showed the opposite trend: high and stable at low-to-median SWE values and decreasing toward the upper extreme.

Species composition appeared to mediate the density relationships. While spruce and fir densities followed the same general association with SWE as the undifferentiated density metric, SWE exerted a higher-magnitude influence on density for spruce than for fir (Fig. 7). The density-SWE relationship for pine was largely decoupled from these, as it declined over the SWE gradient. This was consistent with our expectations that pine would dominate lower-elevation and south-facing slopes and spruce-fir would dominate north-facing slopes and higher elevation positions. *P. contorta* is a relatively drought-tolerant species and pursues different hydraulic strategies to spruce and fir, and is able to compete well on high-radiation xeric sites. Based on prior knowledge of the species' distributions and associations, we expected spruce and fir total stem density to diverge, with spruce density increasing monotonically with elevation and fir density reaching a peak at mid-elevations. However, this appeared not to be the case, as unimodal maxima occurred for both species near middle elevations. This result may be an artifact of looking only at top-of-canopy trees.

We did not attempt to infer causal direction in these relationships, although forest canopy structure and snow dynamics likely exert amplifying and attenuating feedbacks on one another. Tree and canopy structure modifies snow accumulation and ablation (Jost et al. 2007, Varhola et al. 2010, Schneider et al. 2019). Higher canopy density can increase interception, leading to lower surface accumulation than in adjacent gaps or unforested areas (Martin Dickerson-Lange et al. 2017; Dickerson-Lange et al. 2023; Sun et al. 2023). Intercepted snow can return to the atmosphere via sublimation or deposit on the surface through melt or mass release. Trees also influence snow redistribution by modifying wind patterns and intercepting wind-blown snow (Faria et al. 2000). Tree and stand effects on snow melt dynamics are variable. By shading snow from incoming shortwave radiation, trees can slow snowmelt; but as radiating bodies, they can increase melt rates, especially in the zone of influence surrounding individual tree boles (Lawler and Link 2011). The net effects depend in part on scale (Veatch et al. 2009; Bonner et al. 2022; Lundquist et al. 2013). 

In the other direction, seasonal snowpack also influences tree growth and forest structure. Seasonal snowpack provides a reservoir that exceeds soil saturation and may delay soil drydown well into the growing season (Gleason et al. 2021; Bales et. al 2021). Local canopy influences on melt rate influence the size and duration of this reservoir, in turn modifying the quantity of moisture available to meet summer atmospheric demand. In some regions, particularly those with more arid climates, high peak SWE and longer snowpack duration enhance annual tree growth (Littell et al. 2008, Hu et al. 2010, Trujillo et al. 2012, Anderegg et al. 2013, Gleason et al. 2021). However, in more energy-limited systems, the opposite effect is seen because of temperature constraints on tree metabolism (Littell and Peterson 2005, Littell et al. 2008).

The stand density-∆SWE relationship uncovered in our study points to a bidirectional relationship with potential feedbacks at the hectare-to-watershed scale. Stand density appears to have a direct positive effect on snowpack duration, such that snow disappears more slowly in areas of higher density due to shading and wind sheltering. In the other direction, higher snowpack and slower snow disappearance may allow stands to develop at higher densities because of the water subsidy that remains available into the growing-season drought. The height, QMD, and BA peaks in areas of below-average snow disappearance rate suggest that snowpack persistence is also advantageous for individual-tree productivity. However, the positive effect of density on snowpack duration seems to diminish at extremely high densities. This points to a potential negative density-snow feedback: if stands are able to develop beyond a certain density threshold, much of the snow will not reach the forest floor and instead sublimates or ablates directly from the canopy. Conversely, low snow accumulation and fast disappearance in low-density stands may amplify the water constraint on growth, further limiting stand density development over time. 

Soil AWC (cm H_2_O cm ^-1^ soil) is a measure of the water available to plants per unit depth and is parameterized in the SSURGO data as the difference in volumetric water content at field capacity ($\theta_{fc}$, measured at -10 kPa) and at the permanent wilting point ($\theta_{wp}$, measured at -1500 kPa). The association between AWC and density diverged from those between AWC and height, QMD, and BA. Density generally increased with AWC, with kinks in the middle range of AWC values. However, other structural metrics varied nonlinearly with AWC, with a maximum plateau in the middle range of AWC and declines at either extreme. This suggested a potential decoupling of stand-scale and individual-scale dynamics. Where individual trees reach structural maxima at mid-range AWC values, stands appear to be in late successional states characterized by even stature and low density. On the other hand, at very high AWC, stands tend to be denser and less even-aged. One hypothesis, which could be tested through repeat measurement or dendrochronology methods, is that extreme AWC values impose stronger constraints on individual productivity than on stand-level dynamics, such as recruitment and survival. If this is the case, then while the number of trees increases with higher levels of soil available water, there may be a preferential zone of soil moisture facilitating growth for the individual.

As for topography, the inflection of height, QMD, and BA curves along the elevation gradient corresponded approximately to the dividing line between montane and subalpine zones, at around 3000--3200 m elevation. To a crude approximation, this suggests that there exists a zone of preference supporting longevity and/or height and diameter growth occurring around this elevational range. Our group's adjacent dendroecological work suggests that both mechanisms may be at play, as interannual diameter growth is not closely associated with individual tree age (Worsham et al. in prep.). This may have to do with cold-air pooling, where minimum temperatures are depressed at low elevations, in addition to the familiar adiabatic lapse with elevations, because of downwelling of cool air into regionally low areas. The interactive effect of elevation and ∆SWE's on density suggest that this is a plausible interpretation: density was limited where low elevation and long snow residence time co-occurred. That is to say, it may be the case that where pooling cold air preserved snowpack, it also diminished recruitment.

The geological categories we used captured broad differences in geochemistry, fracturing potential, and substrate age, but they did not differentiate all of the important lithologic constraints on tree growth, namely water availability. There is evidence that large trees root into decomposing saprolite at the soil-bedrock interface, and can root even deeper into fractured bedrock as deep as 20 m. Where this subsurface reservoir exists, it can provide a substantial subsidy during seasonal and secular dry periods, offering trees an advantage over those without access to such a subsidy (Hartmann et al. 2020; McCormick et al. 2021; Nardini et al. 2024). Water flow and storage below the soil layer depends heavily on lithologic properties not represented in our categorical feature.

### 4.2.1 Water and energy limitation 

Because AET has been so well correlated with net primary production (negatively, for CWD) (Rosenzweig 1968; Lieth 1975; Fritts 1976; Webb et. al 1983) and CWD with canopy height (Fricker et al. 2019), we expected AET and CWD to have the strongest associations with the five measures of forest structure. We expected these strong climatic signals to be amplified or modulated somewhat by other local topographic and substrate properties, given these factors' importance for ecosystem development at small scales (@delcourt_dynamic_1983). 

Our results did not accord with these expectations, raising questions about water and energy limitation in this high-elevation forested system. We initially assumed that because our domain spanned a 1300 m elevational gradient above 2700 m, we would see evidence of a water-energy (W-E) thresholding effect. It is generally thought that above the W-E threshold, plant growth should be more sensitive to variability in radiation, since PET rarely exceeds AET, and the growing season is short (Hartl-Meier et al., 2014; Roebroek et al., 2020; Sánchez-Salguero et al., 2017; Stephenson, 1998; van der Maaten-Theunissen et al., 2013). We thought stands on the lower end of our elevation range might be sensitive to factors governing water deficit, but that factors governing the radiation budget (AET, heat load, e.g.) would predominate across the majority of the watershed. 

Instead, soil AWC, SWE, and ∆SWE were the dominant signals across the elevational range. Although several studies have identified discontinuities in tree responses to drought and to temperature across elevation gradients, the estimated elevational threshold is extremely uncertain, reported from 800 m to 3200 m (Hartl-Meier et al., 2014; Salzer et al., 2014; van der Maaten-Theunissen et al., 2013). Pinning the threshold to temperature is also uncertain, ranging at least from 8.4 º C (Dudney et al. 2023) to 30 º C (Gantois 2022). This might lead to the conclusion that despite its high elevation, ours is not an essentially energy-limited system, and variability in snow accumulation, melt rate, and available water dictate the spatial pattern of forest structure more so than variability in radiative factors. The strength of the structural associations with AWC, which reflects seasonal storage capacity to some degree, lends support to this interpretation. However, this conclusion seems unlikely because of prior evidence of strong spring and summer energy limitation in this watershed (Carroll et al. 2020, Chen et al. 2021). A confounding factor is that snowpack often influences not only the water budget but also the micro-scale energy budget and can impose an energy limitation on trees by depressing temperatures and diminishing growing-season length (Coulthard et al. 2021). 

An alternate interpretation is that the W-E limitation threshold does not map tightly to an elevational or temperature threshold. W-E limitation may be more of a function of (potentially asynchronous) patterns of moisture availability and radiative forcing, which could have a more mosaic expression on the landscape than a simple temperature threshold might suggest. This expression could easily be missed using spatially discontinuous plot- or gradient-based observations. Consider two sites, A and B, whose position differs only on the aspect gradient. A marginal positive change in irradiance associated with the aspect difference could give rise either to (1) larger trees / higher density stands in Site A vs. Site B or to (2) smaller trees / lower density stands in A vs. B. The former case would suggest that the sites are energy limited, since the temperature and PAR increase yields better conditions for trees in Site A. Conversely, the latter case would indicate water limitation, since the temperature and PAR increase in Site A goes unused by trees and vital rates are constrained by higher evaporative demand. In a low-AET system, slope- and aspect-driven differences in irradiance may be great enough to confound water- and energy-limitation thresholds associated with elevation (Greenberg et al. 2009). Further, more recent work on water-energy limitation suggests that these features drive feedbacks to soil moisture, vegetation cover, and soil formation/erosion that produce W-E limitation gradients that vary widely in space (Pelletier et al. 2018; Wainwright et al. 2022). 

A third interpretation, importantly, acknowledges some uncertainty in the extent to which SWE and ∆SWE act as independent constraints on forest structure, rather than as integrators of other topoclimatic drivers. SWE and ∆SWE proxy both winter precipitation input and also net energy balance. The positive correlation between SWE and elevation (R=0.58; Fig. S4) points to the influence of radiation on this value. In our study design, it was not possible to quantitatively disentangle the interactive effects of water and energy balance on SWE and ∆SWE, and it is likely that these factors' influence on forest structure has as much to do with their constraints on growing season as with moisture subsidy.

# Conclusions

To our knowledge, this paper is the first to evaluate a complement of conifer stand structural and compositional characteristics on a spatially continuous basis at the scale of a full watershed, incorporating end-members on abiotic gradients along which forest stands grow. We have also made original methodological contributions in developing a strategy for systematically training and validating a large suite of ITD algorithms and their parameter combinations against an objective loss function. Our inferential analyses suggest that topographic complexity characteristic of subalpine domains complicates the conventional assumptions of temperature/moisture controls on forest structure, and of water-energy limitation frameworks. We found that factors  related to precipitation input (SWE) and moisture subsidy (∆SWE, AWC) to exert the most influence on multiple stand structural properties. In some cases, our inferences were limited (e.g., regarding the directionality of the snow duration--density relationship); further *in situ* investigation of site soil moisture, interannual tree growth, and snowpack dynamics could help to tease out these mechanisms.

Over the past two decades, the Southern Rocky Mountains have experienced drier and warmer conditions than any prior period in the last millennium, and forests in the region have experienced high canopy water loss and mortality (@williams_rapid_2022). Given the evident importance of total snow accumulation and snowpack duration for stand density, maximum height, relative species densities, and other structural factors, a low-to-no snow future could yield widespread changes in these forests' structure, species mix, and function (Siirla-Woodburn 2021). The results we have presented here could be a foundation for future work to benchmark and predict how these systems will respond to synoptic environmental change in the future. Additionally, evaluating forest structural change in this domain under warmer conditions could enable more detailed characterization of the W-E mosaic. 


# Acknowledgements
This work was funded by the U.S. Department of Energy Watershed Function Scientific Focus Area at Lawrence Berkeley National Lab, by the U.S. Department of Energy Environmental System Science (Project [TODO: #######] "Integrating tree hydraulic trait, forest stand structure, and topographic controls on ecohydrologic function in a Rocky Mountain subalpine watershed"), the Colorado Mountain Club Foundation, the Energy and Resources Group, UC Berkeley (Berkeley, CA, USA), and the Rocky Mountain Biological Lab (RMBL, Gothic, CO, USA). The authors would additionally like to thank RMBL for assistance with field site access, research permitting, and GNSS data acquisition. We also thank Hilary Henry, Sophia Bagshaw, Sarah Hettema, Jessica Katz, and Asa Elliott for field assistance, and Maggi Kelly, Dennis Baldocchi, Marcos Longo, and Ian Breckheimer for productive discussions.

\clearpage

\newpage

# Tables

**Table 1.** Response (RE) and explanatory (EX) variables used in this study's statistical analyses. Variables listed in the "Topography" category were also used in the sampling procedure to stratify inventory plots.

```{r, echo=F}
flextable(tbl1)
```

\clearpage

\newpage

**Table 2.** Measurements taken in field inventory with their units and a summary of methods.

```{r, echo=F}
tbl2
```

\clearpage

\newpage

**Table 3.** Tree height (∆Z) and horizontal (∆XY) distance criteria for candidate searching in the matching procedure (Eysn et al. 2015).

```{r, echo=F}
tbl3
```

\clearpage

\newpage

**Table 4.** Summary statistics for the best-performing runs of six individual tree delineation (ITD) algorithms. Parameters and values for each run appear in Table S1. Root mean squares were computed for results across the 17 training plots.

![](./Figures/tbl4.png)

\clearpage

\newpage

**Table 5.** User-specified parameters ($\lambda_{1:7}$) applied in the LayerStacking algorithm with the optimal values found in training. 

```{r, echo=F}
tbl5
```

\clearpage

\newpage

**Table 6.** Performance
![](./Figures/tbl6.png)

\clearpage

\newpage

**Table 7.** Percent of total deviance explained (PDE) for GAM. Out-of-bag RMSE and validation RMSE for GBM.

```{r, echo=F}
tbl7
```

\clearpage

\newpage

# Figures
## Figure 1
![](./Figures/Fig1.png)

**Figure 1.** The study domain spans the footprint of a June 2018 NEON AOP acquisition in the East River watershed in western Colorado. Dots indicate the locations of 0.16 ha conifer forest inventory plots. Shading is by elevation.
\clearpage

\newpage

![](./Figures/Fig2.png)

**Figure 2.** Crown identification results for one selected training plot ("CC-UC2"). The background greyscale image is a canopy height model derived from discretized full-waveform LIDAR. Circles correspond to field-observed trees, while crosses correspond to trees detected from LiDAR. Successful matches are in red, and unmatched trees in gray. At this site, 302 trees were observed in field inventory; 265 crowns were detected from LiDAR. 55 percent of trees were successfully matched, with 0.44 and 0.37 omission and commission errors, respectively. 

\clearpage

\newpage

![](./Figures/Fig3.png)

**Figure 3.** We optimized individual tree crown detection (ITD) by training and validating the LiDAR-based procedure on trees observed in 17 field inventory plots. Panel A compares, for each inventory plot (x-axis), the median height (y-axis) of all LiDAR detected trees (light blue), all field-observed trees (dark blue), LiDAR-detected trees that were successfully matched to field trees in the training procedure (light green) and their corresponding matches to field-observed trees (dark green). Panel B depicts the frequency distribution (kernel density estimate) of heights (y-axis) across the height gradient in all training plots. Lines that appear closer together in the y-dimension for a given height, the stronger the agreement in training and validation. After validation, we applied the best-performing model to predict trees across the full forested domain. Panel C shows the distribution of trees detected in 1 m height bins across the full domain. Orange bars show the number of trees in a bin as originally estimated; red bars show the number of trees after a density correction factor was applied.

\clearpage

\newpage
![](./Figures/Fig4.png)

**Figure 4.** Maps of basal area (A), 95th percentile height (B), height skew (C), quadratic mean diameter (D), total stand density (E), fir density (F), spruce density (G), and pine density (H) for conifer forest pixels at 100 m resolution across the full forested domain. Species-specific density values are computed from detected tree crowns in the 90th percentile height. Forest struture metrics are masked to areas with conifer forest cover exceeding 100 stems ha^-1^ in density. Also shown is a true-color RGB composite produced from the USDA NRCS National Aerial Imaging Program (NAIP) data acquired in 2019 (I). 

\clearpage

\newpage

![](./Figures/Fig5.png)

**Figure 5.** Frequency distributions of basal area (A), 95th percentile height (B), height skew (C), quadratic mean diameter (D), total stand density (E), fir density (F), spruce density (G), and pine density (H) for conifer forest pixels at 100 m resolution across the full forested domain. Species-specific density values are computed from detected tree crowns in the 90th percentile height.

\clearpage

\newpage

![](./Figures/Fig6.png)

**Figure 6.** Relative variable influence in GBM for all predictor variables (A) and for the five most influential variables for each response (B). In (A), variable categories are clustered by color group (climate=blue, soil=red-orange, topography=green, geology=brown). Shading within color groups is arbitrary. In (B), predictors are ranked in order of their relative contribution to variance explained, averaged over all splits. Colors in B correspond to those in A.

\clearpage

\newpage

![](./Figures/Fig7.png)

**Figure 7.** GAM partial effects on forest structure responses of the five most important variables identified for each response through GBM. Panels correspond to the eight structural/compositional metrics modeled. All relationships presented here were significant in GAM.
\clearpage

\newpage

![](./Figures/Fig8.png)
**Figure 8.** Box plots describing coefficients on geological substrates from GAMs. Panels correspond to the eight structural/compositional metrics modeled. Each box shows the anomaly from the mean response value associated with each substrate, if the difference was significant in t-testing (p < 0.01). In each box, the central line is the estimate, the upper and lower boundaries mark $\pm\ one s.e. from the estimate, and whiskers extend to two s.e. Coefficients with insignificant estimates in each model are not shown. Y-axis values are anomalies in the units of the structural metric. The line at y=0 in each panel emphasizes the mean reference. X-axis symbols are defined as follows: KJde = Dakota Sandstone, Km = Mancos Shale, Kmv = Mesa Verde Formation (sandstone-siltstone-coal), Pm = Gothic Formation (sandstone-shale), PPm = Maroon Formation (red sandstone-mudstone-conglomerate), Qd = glacial drift, Ql = landslide deposits, Tmi = Middle-Tertiary granodioritic laccoliths, dikes and sills, Two = Wasatch Formation (claystone-shale).

\clearpage

\newpage


![](./Figures/Fig9.png)
**Figure 9.** Variable interaction plots demonstrate the strong, nonlinear elevational control on density (A), maximum height (B), QMD (C), and BA (D). Interaction plots show the two strongest explainers of each response variable. The influence of elevation is mediated by SWE, slope angle, soil AWC, and soil organic matter, respectively.

\clearpage

\newpage

# Supplementary Information

<!-- **Figure S1.** Distributions of inventory plots along six topographic gradients. -->
<!-- \clearpage -->

<!-- \newpage -->

**Table S1.** Algorithms, parameters, and vectors of values applied on those parameters in ITD training and validation. 

\clearpage

\newpage

![](./Figures/FigS3.png)
**Figure S3.** Raster images of abiotic explanatory variables. For geology, the numeric scale [1-9] corresponds denotes the following lithologic groups: [1] Dakota Sandstone, [2] Mancos Shale, [3] Mesa Verde Formation (Sand/Silt/Coal), [4] Gothic Formation (Sand/Shale), [5] Maroon Formation (Red Sand/Mud/Conglomerate), [6] Glacial Drift, [7] Landslide Deposits, [8] Middle-Tertiary Granodioritic Laccoliths, [9] Wasatch Formation (Claystone-Shale).

\clearpage

\newpage

<!-- **Figure S4.**  -->

<!-- \clearpage -->

<!-- \newpage -->

<!---
## Table X. Summary statistics by species for trees observed in field census.
```{r, echo=F, message=F, warning=F, layout="l-body-outset"}
library(dplyr)
library(knitr)
full_unq_inv <- read.csv(file.path('~', 'Repos', 'er', 'er-forest-inventory', 'data', 'processed', 'census1_collated', 'EastRiver_Census1_Data_Collated.csv'))
full_unq_inv <- full_unq_inv[full_unq_inv$Status %in% c('L', 'Live', 'LIVE'),]
full_unq_inv <- full_unq_inv[!full_unq_inv$Site_Name %in% c('XX-CAR1',
                                                           'XX-CAR2',
                                                           'XX-PLN1',
                                                           'XX-PLN2'),]
full_unq_inv <- full_unq_inv[!full_unq_inv$Sp_Code %in% c(NA, 'UNKN'),]
```

```{r, echo=F, message=F, warning=F, layout="l-body-outset"}
kable(full_unq_inv %>%
  group_by(Sp_Code) %>%
  summarise('N'=n(),
            'Median height (m)'=round(median(Height_Avg_M, na.rm=T),0),
            'Median DBH (cm)'=round(median(DBH_Avg_CM, na.rm=T),1),
            'Stem Density (stems ha^-1)'=round(n()/2.72,0),
            'Basal area (m^2 ha^-1)'=round(sum(pi*(DBH_Avg_CM/2)^2, na.rm=T)/2.72*(10^-4),1)))
```

## Table X. Summary statistics by plot for trees observed in field census.
```{r, echo=F, message=F, warning=F, layout="l-body-outset"}
kable(full_unq_inv %>%
  group_by(Site_Name) %>%
  summarise('N'=n(),
            'N\ species'=length(unique(Sp_Code)),
            'Median height (m)'=round(median(Height_Avg_M, na.rm=T),0),
            'Median DBH (cm)'=round(median(DBH_Avg_CM, na.rm=T),1),
            'Stem Density'=round(n()/.16,0),
            'Basal area (m^2 ha^-1)'=round((sum(pi*(DBH_Avg_CM/2)^2, na.rm=T)/.16)*(10^-4),1)))
```
--->

# References

